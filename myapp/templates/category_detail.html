{% extends 'base.html' %}

{% block title %}{{ category.name }}{% endblock %}

{% block content %}
<section class="category-products">
    <h2>{{ category.name }}</h2>

    <div class="fp-all-product-grid">
        {% for product in products %}
            <div class="fp-all-product-card">

                {% if product.is_on_sale %}
                    <span class="fp-all-product-badge fp-all-product-sale-badge">
                        Price Off
                    </span>
                {% endif %}

                <img src="{{ product.image.url }}" alt="{{ product.name }}" class="fp-all-product-image">

                <div class="fp-all-product-card-content">
                    <h3 class="fp-all-product-name">{{ product.name }}</h3>
                    <p class="fp-all-product-price">৳{{ product.price }}</p>
                    <button class="add-to-cart-btn"
                        data-product-id="{{ product.id }}">Add to Cart
                    </button>
                </div>
            </div>
        {% empty %}
            <p>No products in this category.</p>
        {% endfor %}
    </div>

    <!-- PAGINATION -->

    <div class="pagination">

        <!-- Previous Button -->
        {% if products.has_previous %}
            <a class="page-btn" href="?page={{ products.previous_page_number }}">Previous</a>
        {% else %}
            <span class="page-btn disabled">Previous</span>
        {% endif %}

        <!-- Always show first page -->
        <a class="page-number {% if products.number == 1 %}active{% endif %}" href="?page=1">1</a>

        <!-- Show dots if needed -->
        {% if products.number > 4 %}
            <span class="dots">…</span>
        {% endif %}

        <!-- Middle pages -->
        {% for num in products.paginator.page_range %}
            {% if num > 1 and num < products.paginator.num_pages %}
                {% if num >= products.number|add:'-1' and num <= products.number|add:'1' %}
                    <a class="page-number {% if products.number == num %}active{% endif %}"
                    href="?page={{ num }}">{{ num }}</a>
                {% endif %}
            {% endif %}
        {% endfor %}

        <!-- Show dots before last -->
        {% if products.number < products.paginator.num_pages|add:'-3' %}
            <span class="dots">…</span>
        {% endif %}

        <!-- Always show last page (if more than one page) -->
        {% if products.paginator.num_pages > 1 %}
            <a class="page-number {% if products.number == products.paginator.num_pages %}active{% endif %}"
            href="?page={{ products.paginator.num_pages }}">
            {{ products.paginator.num_pages }}
            </a>
        {% endif %}

        <!-- Next Button -->
        {% if products.has_next %}
            <a class="page-btn" href="?page={{ products.next_page_number }}">Next</a>
        {% else %}
            <span class="page-btn disabled">Next</span>
        {% endif %}

    </div>
</section>
{% endblock %}
